{% liquid
  assign section_classes = 'campaign-entry-grid section'
  if section.settings.enable_inview
    assign section_classes = section_classes | append: ' js-inview-trigger'
  endif
%}

{% capture campaign_entry_cards_json %}
[
  {
    "eyebrow": "活動頁面",
    "title": "111 檔期主題頁",
    "body": "<p>套用雙主視覺與限時 CTA，快速測試雙11 行銷方案。</p>",
    "link_label": "查看活動頁",
    "link_url": "/pages/111-campaign",
    "link_aria_label": "查看 111 檔期活動主題頁",
    "image": {
      "alt": "111 主題頁預覽",
      "webp": "111-hero-right-345.webp",
      "fallback": "111-hero-right-345.png",
      "width": 345,
      "height": 737
    }
  },
  {
    "eyebrow": "新手頁面",
    "title": "新手上線教學",
    "body": "<p>整合 How-to、FAQ 與社群背書，協助新戶 24 小時內完成頁面。</p>",
    "link_label": "開啟新手頁",
    "link_url": "/pages/newbie",
    "link_aria_label": "開啟新手上線教學頁面",
    "image": {
      "alt": "新手頁面預覽",
      "webp": "newbie-hero-95.webp",
      "fallback": "newbie-hero-95.png",
      "width": 95,
      "height": 532
    }
  },
  {
    "eyebrow": "囤貨頁面",
    "title": "囤貨補貨主題頁",
    "body": "<p>用倒數 USP 與加價購模組，集中呈現年度囤貨提案。</p>",
    "link_label": "進入囤貨頁",
    "link_url": "/pages/stockup",
    "link_aria_label": "進入囤貨補貨主題頁",
    "image": {
      "alt": "囤貨頁面預覽",
      "webp": "stock-hero-184.webp",
      "fallback": "stock-hero-184.png",
      "width": 184,
      "height": 451
    }
  }
]
{% endcapture %}
{% # theme-check-disable UnknownFilter %}
{% assign campaign_entry_cards = campaign_entry_cards_json | strip | parse_json %}
{% # theme-check-enable UnknownFilter %}
{% assign campaign_entry_image_widths = '480, 768, 1200' %}
{% assign campaign_entry_image_sizes = '(max-width: 480px) 92vw, (max-width: 960px) 44vw, 360px' %}

<section
  id="campaign-entry-grid-{{ section.id }}"
  class="{{ section_classes }}"
  data-section-id="{{ section.id }}"
>
  <div class="campaign-entry-grid__inner">
    <header class="campaign-entry-grid__header">
      {% if section.settings.heading != blank %}
        <h2 class="campaign-entry-grid__heading">{{ section.settings.heading | escape }}</h2>
      {% endif %}
      {% if section.settings.subheading != blank %}
        <div class="campaign-entry-grid__subheading">{{ section.settings.subheading }}</div>
      {% endif %}
    </header>

    <div class="campaign-entry-grid__list" role="list">
      {% if section.blocks.size > 0 %}
        {% for block in section.blocks %}
          {% assign fallback = campaign_entry_cards[forloop.index0] %}
          {% if fallback == nil %}
            {% assign fallback = campaign_entry_cards.last %}
          {% endif %}
          {% assign card_eyebrow = block.settings.eyebrow | default: fallback.eyebrow %}
          {% assign card_title = block.settings.title | default: fallback.title %}
          {% assign card_body = block.settings.body | default: fallback.body %}
          {% assign card_link_label = block.settings.link_label | default: fallback.link_label %}
          {% assign card_link_url = block.settings.link | default: fallback.link_url | default: '#' %}
          {% assign card_link_aria = block.settings.link_aria_label | default: fallback.link_aria_label | default: card_link_label %}
          {% assign card_image = block.settings.image %}
          {% assign fallback_image = fallback.image %}
          <article class="campaign-entry-grid__card" role="listitem" {{ block.shopify_attributes }}>
            <div class="campaign-entry-grid__media">
              {% assign card_image_alt = card_image.alt | default: card_title | escape %}
              {% assign fallback_asset = images[fallback_image.fallback] %}
              {% assign fallback_alt = fallback_image.alt | default: card_title | escape %}
              {% if card_image %}
                {{ card_image
                  | image_url: width: 1200
                  | image_tag:
                    widths: campaign_entry_image_widths,
                    sizes: campaign_entry_image_sizes,
                    alt: card_image_alt,
                    loading: 'lazy',
                    decoding: 'async'
                }}
              {% elsif fallback_asset %}
                {{ fallback_asset
                  | image_url: width: 1200
                  | image_tag:
                    widths: campaign_entry_image_widths,
                    sizes: campaign_entry_image_sizes,
                    alt: fallback_alt,
                    loading: 'lazy',
                    decoding: 'async'
                }}
              {% elseif fallback_image.fallback != blank %}
                <img
                  src="{{ fallback_image.fallback | asset_url }}"
                  alt="{{ fallback_alt }}"
                  width="{{ fallback_image.width | default: 720 }}"
                  height="{{ fallback_image.height | default: 540 }}"
                  loading="lazy"
                  decoding="async"
                >
              {% endif %}
            </div>
            <div class="campaign-entry-grid__content">
              {% if card_eyebrow != blank %}
                <p class="campaign-entry-grid__eyebrow">{{ card_eyebrow | escape }}</p>
              {% endif %}
              {% if card_title != blank %}
                <h3 class="campaign-entry-grid__title">{{ card_title | escape }}</h3>
              {% endif %}
              {% if card_body != blank %}
                <div class="campaign-entry-grid__body">{{ card_body }}</div>
              {% endif %}
              {% if card_link_label != blank %}
                <a
                  class="campaign-entry-grid__cta"
                  href="{{ card_link_url }}"
                  aria-label="{{ card_link_aria | escape }}"
                  {% if block.settings.open_in_new_tab %}
                    target="_blank" rel="noopener"
                  {% endif %}
                >
                  {{ card_link_label | escape }}
                </a>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      {% else %}
        {% for card in campaign_entry_cards %}
          <article class="campaign-entry-grid__card" role="listitem">
            <div class="campaign-entry-grid__media">
              {% assign fallback_asset = images[card.image.fallback] %}
              {% assign fallback_alt = card.image.alt | default: card.title | escape %}
              {% if fallback_asset %}
                {{ fallback_asset
                  | image_url: width: 1200
                  | image_tag:
                    widths: campaign_entry_image_widths,
                    sizes: campaign_entry_image_sizes,
                    alt: fallback_alt,
                    loading: 'lazy',
                    decoding: 'async'
                }}
              {% elsif card.image.fallback != blank %}
                <img
                  src="{{ card.image.fallback | asset_url }}"
                  alt="{{ fallback_alt }}"
                  width="{{ card.image.width | default: 720 }}"
                  height="{{ card.image.height | default: 540 }}"
                  loading="lazy"
                  decoding="async"
                >
              {% endif %}
            </div>
            <div class="campaign-entry-grid__content">
              {% if card.eyebrow != blank %}
                <p class="campaign-entry-grid__eyebrow">{{ card.eyebrow | escape }}</p>
              {% endif %}
              {% if card.title != blank %}
                <h3 class="campaign-entry-grid__title">{{ card.title | escape }}</h3>
              {% endif %}
              {% if card.body != blank %}
                <div class="campaign-entry-grid__body">{{ card.body }}</div>
              {% endif %}
              {% if card.link_label != blank %}
                <a
                  class="campaign-entry-grid__cta"
                  href="{{ card.link_url | default: '#' }}"
                  aria-label="{{ card.link_aria_label | default: card.link_label | escape }}"
                >
                  {{ card.link_label | escape }}
                </a>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Campaign entry grid",
  "tag": "section",
  "class": "campaign-entry-grid__section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "主標題",
      "default": "主題行銷頁快速導覽"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "說明文字",
      "default": "<p>挑選想預覽的行銷頁面，一鍵跳轉到對應範例。</p>"
    },
    {
      "type": "checkbox",
      "id": "enable_inview",
      "label": "啟用入場動畫 class",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "導覽卡片",
      "limit": 6,
      "settings": [
        {
          "type": "text",
          "id": "eyebrow",
          "label": "小標"
        },
        {
          "type": "text",
          "id": "title",
          "label": "標題"
        },
        {
          "type": "richtext",
          "id": "body",
          "label": "內文"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "代表圖片"
        },
        {
          "type": "url",
          "id": "link",
          "label": "連結網址"
        },
        {
          "type": "text",
          "id": "link_label",
          "label": "按鈕文字",
          "default": "了解更多"
        },
        {
          "type": "text",
          "id": "link_aria_label",
          "label": "按鈕 ARIA 標籤"
        },
        {
          "type": "checkbox",
          "id": "open_in_new_tab",
          "label": "開新分頁",
          "default": false
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Campaign landing shortcuts",
      "blocks": [
        { "type": "card" },
        { "type": "card" },
        { "type": "card" }
      ]
    }
  ]
}
{% endschema %}
