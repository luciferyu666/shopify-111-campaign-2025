{% liquid
  assign section_classes = 'bundle-tiles'
  if section.settings.enable_slider
    assign section_classes = section_classes | append: ' bundle-tiles--slider'
  endif
  if section.settings.enable_inview
    assign section_classes = section_classes | append: ' js-inview-trigger'
  endif
  assign campaign_preset = section.settings.campaign_preset | default: ''
%}

{% capture bundle_tiles_presets_json %}
{
  "111": [
    {
      "tag": "限時 72hr",
      "title": "111A 超值加購組",
      "description": "5 件禮盒 + 滿額券，檔期直接帶入 CTA。",
      "image": {
        "alt": "111 A 組商品圖",
        "webp": "111-bundle-a-690.webp",
        "fallback": "111-bundle-a-690.png",
        "width": 690,
        "height": 553
      },
      "price_label": "專案價",
      "price_value": "$1,110",
      "link_label": "查看 A 組",
      "link_url": "#promo"
    },
    {
      "tag": "滿額加碼",
      "title": "111B 高毛利組",
      "description": "含右半視覺，直接給行動版 2 欄展示。",
      "image": {
        "alt": "111 B 組商品圖",
        "webp": "111-bundle-b-690.webp",
        "fallback": "111-bundle-b-690.png",
        "width": 690,
        "height": 511
      },
      "price_label": "套裝價",
      "price_value": "$2,490",
      "link_label": "開啟 B 組",
      "link_url": "#promo"
    },
    {
      "tag": "限量 1500",
      "title": "111 限量贈品",
      "description": "附 480 / 690px 兩種尺寸 srcset，搭配任一 CTA。",
      "image": {
        "alt": "111 限量贈品",
        "webp": "111-addon-1500-690.webp",
        "fallback": "111-addon-1500-690.png",
        "width": 690,
        "height": 246
      },
      "price_label": "加購價",
      "price_value": "$150",
      "link_label": "加入贈品",
      "link_url": "#bundles"
    }
  ],
  "newbie": [
    {
      "tag": "步驟 01",
      "title": "Starter Bundles",
      "description": "newbie-starter-bundles-95 列出首購組合，直接放入新戶專區。",
      "image": {
        "alt": "新手 starter 組圖",
        "webp": "newbie-starter-bundles-95.webp",
        "fallback": "newbie-starter-bundles-95.png",
        "width": 95,
        "height": 369
      },
      "price_label": "建議售價",
      "price_value": "$990",
      "link_label": "複製組合",
      "link_url": "#promo"
    },
    {
      "tag": "步驟 02",
      "title": "FAQ CTA 卡",
      "description": "newbie-faq-cta-95.png 搭配折角設計，可延伸成支援卡片。",
      "image": {
        "alt": "新手 FAQ 圖片",
        "webp": "newbie-faq-cta-95.webp",
        "fallback": "newbie-faq-cta-95.png",
        "width": 95,
        "height": 246
      },
      "price_label": "導購文案",
      "price_value": "自訂",
      "link_label": "導入 FAQ",
      "link_url": "#faq"
    },
    {
      "tag": "步驟 03",
      "title": "社群背書",
      "description": "newbie-reviews-95 圖塊可直接與 CTA 結合，提升信任。",
      "image": {
        "alt": "新手評價圖",
        "webp": "newbie-reviews-95.webp",
        "fallback": "newbie-reviews-95.png",
        "width": 95,
        "height": 266
      },
      "price_label": "轉換率",
      "price_value": "+18%",
      "link_label": "放進評價區",
      "link_url": "#promo"
    }
  ],
  "stock": [
    {
      "tag": "大量備貨",
      "title": "年度囤貨組",
      "description": "stock-annual-bundle-184 以 4:5 構圖呈現倉庫氛圍。",
      "image": {
        "alt": "囤貨年度組圖片",
        "webp": "stock-annual-bundle-184.webp",
        "fallback": "stock-annual-bundle-184.png",
        "width": 184,
        "height": 471
      },
      "price_label": "團購價",
      "price_value": "$8,880",
      "link_label": "立即囤貨",
      "link_url": "#promo"
    },
    {
      "tag": "門市加價購",
      "title": "補貨加碼包",
      "description": "stock-addon-1500-184 切圖適合放在桌機 3 欄／手機 1 欄。",
      "image": {
        "alt": "囤貨加價購圖片",
        "webp": "stock-addon-1500-184.webp",
        "fallback": "stock-addon-1500-184.png",
        "width": 184,
        "height": 185
      },
      "price_label": "加購價",
      "price_value": "$1,500",
      "link_label": "導入加購",
      "link_url": "#bundles"
    },
    {
      "tag": "爆款排行",
      "title": "Top Products 卡",
      "description": "stock-top-products-184 彙整 3 款熱銷，適合搭配 USP。",
      "image": {
        "alt": "囤貨熱銷圖",
        "webp": "stock-top-products-184.webp",
        "fallback": "stock-top-products-184.png",
        "width": 184,
        "height": 327
      },
      "price_label": "平均毛利",
      "price_value": "+12%",
      "link_label": "放入排行榜",
      "link_url": "#promo"
    }
  ]
}
{% endcapture %}
{% # theme-check-disable UnknownFilter %}
{% assign bundle_tiles_presets = bundle_tiles_presets_json | strip | parse_json %}
{% # theme-check-enable UnknownFilter %}
{% assign bundle_tiles_preset = bundle_tiles_presets[campaign_preset] %}
{% assign bundle_responsive_widths = '480, 768, 1280' %}
{% assign bundle_image_sizes = '(max-width: 480px) 90vw, (max-width: 768px) 45vw, 360px' %}

<section
  id="bundle-tiles-{{ section.id }}"
  class="{{ section_classes }}"
  data-section-id="{{ section.id }}"
>
  <header class="bundle-tiles__header">
    {% if section.settings.heading != blank %}
      <h2 class="bundle-tiles__heading">{{ section.settings.heading }}</h2>
    {% endif %}
    {% if section.settings.subheading != blank %}
      <p class="bundle-tiles__subheading">{{ section.settings.subheading }}</p>
    {% endif %}
    {% if section.settings.link_label != blank %}
      <a
        class="bundle-tiles__cta"
        href="{{ section.settings.link | default: '#' }}"
        {% if section.settings.link_aria_label != blank %}
          aria-label="{{ section.settings.link_aria_label | escape }}"
        {% endif %}
        {% if section.settings.open_in_new_tab %}
          target="_blank" rel="noopener"
        {% endif %}
      >
        {{ section.settings.link_label | escape }}
      </a>
    {% endif %}
  </header>
  <div class="bundle-tiles__grid" role="list">
    {% if bundle_tiles_preset %}
      {% for tile in bundle_tiles_preset %}
        <article class="bundle-tiles__item" role="listitem">
          {% if tile.tag != blank %}
            <p class="bundle-tiles__tag">{{ tile.tag | escape }}</p>
          {% endif %}
          {% if tile.image %}
            {% assign bundle_tile_fallback = images[tile.image.fallback] %}
            {% assign tile_image_alt = tile.image.alt | default: tile.title | escape %}
            <div class="bundle-tiles__image">
              {% if bundle_tile_fallback %}
                {{ bundle_tile_fallback
                  | image_url: width: 1280
                  | image_tag:
                    widths: bundle_responsive_widths,
                    sizes: bundle_image_sizes,
                    alt: tile_image_alt,
                    loading: 'lazy',
                    decoding: 'async'
                }}
              {% elsif tile.image.fallback != blank %}
                <img
                  src="{{ tile.image.fallback | asset_url }}"
                  alt="{{ tile_image_alt }}"
                  width="{{ tile.image.width | default: 720 }}"
                  height="{{ tile.image.height | default: 540 }}"
                  loading="lazy"
                  decoding="async"
                >
              {% endif %}
            </div>
          {% endif %}
          <div class="bundle-tiles__content">
            <h3 class="bundle-tiles__title">{{ tile.title | escape }}</h3>
            {% if tile.description != blank %}
              <p class="bundle-tiles__description">{{ tile.description | escape }}</p>
            {% endif %}
            {% if tile.price_label != blank or tile.price_value != blank %}
              <p class="bundle-tiles__price">
                <span class="bundle-tiles__price-label">{{ tile.price_label | escape }}</span>
                <span class="bundle-tiles__price-value">{{ tile.price_value | escape }}</span>
              </p>
            {% endif %}
            {% if tile.link_label != blank %}
              <a
                class="bundle-tiles__link"
                href="{{ tile.link_url | default: '#' }}"
              >
                {{ tile.link_label | escape }}
              </a>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    {% else %}
      {% for block in section.blocks %}
        <article
          class="bundle-tiles__item"
          role="listitem"
          {{ block.shopify_attributes }}
        >
          {% if block.settings.tag != blank %}
            <p class="bundle-tiles__tag">{{ block.settings.tag | escape }}</p>
          {% endif %}
          {% if block.settings.image != blank %}
            <div class="bundle-tiles__image">
              {% assign block_image_alt = block.settings.image.alt | default: block.settings.title | escape %}
              {{ block.settings.image
                | image_url: width: 1280
                | image_tag:
                  widths: bundle_responsive_widths,
                  sizes: bundle_image_sizes,
                  alt: block_image_alt,
                  loading: 'lazy',
                  decoding: 'async'
              }}
            </div>
          {% endif %}
          <div class="bundle-tiles__content">
            <h3 class="bundle-tiles__title">{{ block.settings.title | escape }}</h3>
            {% if block.settings.description != blank %}
              <p class="bundle-tiles__description">{{ block.settings.description }}</p>
            {% endif %}
            {% if block.settings.price_label != blank or block.settings.price_value != blank %}
              <p class="bundle-tiles__price">
                <span class="bundle-tiles__price-label">{{ block.settings.price_label | escape }}</span>
                <span class="bundle-tiles__price-value">{{ block.settings.price_value | escape }}</span>
              </p>
            {% endif %}
            {% if block.settings.link_label != blank %}
              <a
                class="bundle-tiles__link"
                href="{{ block.settings.link | default: '#' }}"
                {% if block.settings.link_aria_label != blank %}
                  aria-label="{{ block.settings.link_aria_label | escape }}"
                {% endif %}
                {% if block.settings.open_in_new_tab %}
                  target="_blank" rel="noopener"
                {% endif %}
              >
                {{ block.settings.link_label | escape }}
              </a>
            {% endif %}
          </div>
        </article>
      {% else %}
        <p class="bundle-tiles__empty" role="note">
          Add bundle blocks to showcase curated product sets.
        </p>
      {% endfor %}
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Bundle tiles",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "select",
      "id": "campaign_preset",
      "label": "套用官方素材",
      "info": "選擇 stock / newbie / 111 可直接載入切圖與文案，留白則使用自訂區塊。",
      "options": [
        { "value": "", "label": "不使用預設" },
        { "value": "stock", "label": "囤貨行銷（stock）" },
        { "value": "newbie", "label": "新手行銷（newbie）" },
        { "value": "111", "label": "雙11 主題（111）" }
      ],
      "default": ""
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Section heading",
      "default": "Bundle and save"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Section subheading",
      "default": "<p>Feature curated bundles tailored to campaign goals.</p>"
    },
    {
      "type": "text",
      "id": "link_label",
      "label": "Secondary link label",
      "default": "View all bundles"
    },
    {
      "type": "url",
      "id": "link",
      "label": "Secondary link URL"
    },
    {
      "type": "text",
      "id": "link_aria_label",
      "label": "Secondary link ARIA label",
      "default": "View all campaign bundles"
    },
    {
      "type": "checkbox",
      "id": "open_in_new_tab",
      "label": "Secondary link opens in new tab",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_slider",
      "label": "Enable slider treatment",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_inview",
      "label": "Enable in-view animations",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "bundle",
      "name": "Bundle tile",
      "limit": 6,
      "settings": [
        {
          "type": "text",
          "id": "tag",
          "label": "Highlight tag",
          "default": "Best seller"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Tile image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Holiday starter kit"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>Everything you need to launch your 111 campaign.</p>"
        },
        {
          "type": "text",
          "id": "price_label",
          "label": "Price label",
          "default": "From"
        },
        {
          "type": "text",
          "id": "price_value",
          "label": "Price value",
          "default": "$149"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link URL"
        },
        {
          "type": "text",
          "id": "link_label",
          "label": "Link label",
          "default": "View details"
        },
        {
          "type": "text",
          "id": "link_aria_label",
          "label": "Link ARIA label",
          "default": "View bundle details"
        },
        {
          "type": "checkbox",
          "id": "open_in_new_tab",
          "label": "Open link in new tab",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Bundle tiles",
      "blocks": [
        { "type": "bundle" },
        { "type": "bundle" },
        { "type": "bundle" }
      ]
    }
  ]
}
{% endschema %}


